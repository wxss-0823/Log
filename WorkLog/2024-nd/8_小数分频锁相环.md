# 小数分频锁相环工作原理

## 锁相环基础

### 一般流程

- 参考无噪声稳定信源 $\to$ R计数器
- 压控振荡器 $\to$ N计数器
- 通过鉴相器及电荷泵、环路滤波器回到压控振荡器，并输出

### 鉴相频率（PDF）

- $\frac{f_{ref}}{R}=\frac{f_{vco}}{N} \Rightarrow f_{vco}=N \cdot \frac{f_{ref}}{R} = N \cdot PDF$
- 小数锁相环N计数单元是小数

### 优点

- 鉴相频率（PDF）有更多选择

> 例如，步进频率为30 kHz：
>
> - 整数分频锁相环：
>
>   $f_{vco}=(N)PDF,(N+1)PDF,(N+2)PDF,...$
>
>   最小鉴相频率（PDF）=30 kHz
>
> - 小数分频锁相环：
>
>   $f_{vco}=(N_{int})PDF,(N_{int}+N_{fractional})PDF,(N_{int}+2N_{fractional})PDF,...$
>
>   在满足最小频率步进的前提下，可以选择不同的PDF

- N值较小，噪声少

> 为了满足最小步进频率，整数锁相环需要牺牲鉴相频率，导致N值很大；
>
> 而小数锁相环可以任意设置鉴相频率以满足最小步进频率

### 频率准确度

- 小数分频锁相环的分辨率（FDEN）取决于N位计数器的位数（n）：$FDEN=2^n-1$
- $N_{fractional}=\frac{FNUM}{FDEN},FNUM=0,1,2,..,FDEN$
- 最低频率步进为：$\frac{PDF}{FDEN}$

## Delta sigma  小数分频锁相环

### 第一级

- 没有补偿的传统式小数锁相环
- N计数器交替采用2个数值
- 瞬时相位错误会产生大量的小数杂散，并出现在偏移中心频率$N_{fractional}PDF$处，在时域出现在时间间隔为$t=\frac{1}{PDF}$

### 第二级

- 采用4个数值，即增加锁相环的阶数

### 第三级

- 采用8个数值

## 杂散

### 参考杂散

- 因电荷泵出现漏电而产生
- 出现在以鉴相频率（PDF）为步进之处

- 环路带宽越低，杂散越小
  - 锁定时间较长
  - 相位噪声更多
- PDF越大，杂散越小
  - 采用小数分频锁相环

### 小数杂散

- 瞬时相位一旦有变化，便会产生小数杂散
  - 小数分频平均计算方法
- 出现在$N_{fractional}PDF$的偏移值中
- 亚小数杂散出现在小数杂散频率的$\frac{1}{2},\frac{1}{4}$谐波处

### 抑制小数杂散的方法

- 较高阶的Delta sigma小数分频锁相环
  - 将小数杂散推高至高频区，环路滤波器滤除
- 添加随机性
  - 为小数分频平均序列添加随机性
  - 降低周期性可以将小数推至高频区
  - 对亚小数杂散产生最大影响
  - 对小数杂散产生较小影响
  - 更多相位噪声
    - 环路带宽越高，相位噪声 越多
- 小数字
  - FDEN，分辨率越高越能抑制小数杂散
- 较高阶的环路滤波器
  - 增加滤波器极点即可降低环路带宽

